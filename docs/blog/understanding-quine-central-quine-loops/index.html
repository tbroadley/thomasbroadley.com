<html lang="en">
  <head>
    <title>
      Understanding quine-central: how do quine loops work?—Thomas Broadley
    </title>

    <meta
      name="description"
      content="An explanation of how the quine loops generated by quine-central work."
    />

    <meta charset="utf-8" />

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/manifest.json" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5" />
    <meta name="theme-color" content="#ffffff" />

    <link
      rel="alternate"
      type="application/rss+xml"
      href="https://thomasbroadley.com/blog/rss.xml"
    />

    <script>
      (function (i, s, o, g, r, a, m) {
        i["GoogleAnalyticsObject"] = r;
        (i[r] =
          i[r] ||
          function () {
            (i[r].q = i[r].q || []).push(arguments);
          }),
          (i[r].l = 1 * new Date());
        (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
      })(
        window,
        document,
        "script",
        "https://www.google-analytics.com/analytics.js",
        "ga"
      );

      ga("create", "UA-96230441-1", "auto");
      ga("send", "pageview");
    </script>

    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link
      href="https://fonts.googleapis.com/css?family=Roboto+Slab|Roboto|Source+Code+Pro"
      rel="stylesheet"
    />
    <link href="/index.css" rel="stylesheet" />

    <style>
      p.image > img {
        max-width: 100%;
      }

      @media (max-width: 599px) {
        p.image {
          overflow-x: auto;
        }

        p.image > img {
          max-width: 200%;
        }
      }

      p.image-centered {
        text-align: center;
      }

      p.blogchain {
        display: flex;
        justify-content: center;
      }

      p.blogchain > * {
        display: block;
        text-align: center;
      }

      p.blogchain > *:not(:last-child) {
        margin-right: 1rem;
      }
    </style>

    <link
      href="https://unpkg.com/prismjs@1.21.0/themes/prism.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <nav>
      <a href="..">All posts</a>
      &middot;
      <a href="../rss.xml">RSS</a>
    </nav>

    <article>
      <header>
        <h1>
          Understanding <code>quine-central</code>: how do quine loops work?
        </h1>
        <p class="timestamp">
          2020-09-24
        </p>

        <p class="blogchain">
          <span style="visibility: hidden;">&larr;</span>

          <a href="../tags/quine-central">
            <code>quine-central</code>
          </a>

          <a href="../understanding-quine-central-the-source-code">&rarr;</a>
        </p>
        <p class="blogchain">
          <a href="../rc-day-3">&larr;</a>

          <a href="../tags/rc-mini-7-2020">
            RC Mini 7, 2020
          </a>

          <a href="../rc-day-4">&rarr;</a>
        </p>

        <hr />
      </header>

      <section>
        <p>
          Yesterday another Recurser introduced me to
          <a href="https://github.com/dpiponi/quine-central"
            ><code>quine-central</code></a
          >, which is:
        </p>
        <blockquote>
          <p>
            [A] Haskell program that generates a Haskell program that prints out
            a Perl program that prints out a Python program that prints out a
            Ruby program that prints out a C program that prints out a Java
            program that prints out a Rust program that prints out an OCaml
            program that prints out a Swift program that prints out a Racket
            program that prints out a Javascript program that prints out the
            first Haskell program generated.
          </p>
        </blockquote>
        <p>
          “How the hell does that work?” I thought to myself. Maybe you’re
          thinking that too, so here’s my attempt at an explanation.
        </p>
        <p>
          <code>quine-central</code> can produce quine loops of any length, so
          let’s first think about a loop of three programming languages:
          Haskell, Ruby, and C. In this case, <code>quine-central</code> prints
          a Haskell program that prints a Ruby program that prints a C program
          that prints the first Haskell program generated.
        </p>
        <p class="image image-centered">
          <img
            src="loop.png"
            alt="A loop of languages, going from Haskell to Ruby to C and back to Haskell."
          />
        </p>
        <p>
          The generated Haskell program has two lines. The first line defines a
          function called <code>q</code> that takes three arguments.
          <code>q</code> builds and returns a string that contains its first
          argument, then a newline, and finally some Ruby code that calls a
          function called <code>q</code>. This call to <code>q</code> in Ruby
          takes the same arguments but rotated one position to the left. That
          is, it takes the second argument to the Haskell <code>q</code>, then
          the third, then the first.
        </p>
        <p class="image">
          <img
            src="first-line.png"
            alt="A diagram explaining q&#x27;s implementation in Haskell. q takes three arguments: a0, a1, and a2. q returns a0 concatenated with a newline, then the string q(&#x22;, then a1, then the string &#x22;,&#x22;, then a2, then the string &#x22;,&#x22;, then a0, and finally the string &#x22;). Its output is the value of a0 on the first line, then a call to q in Ruby with the arguments a1, a2, and a0 on the second line."
          />
        </p>
        <p>
          In the actual output, <code>{a0}</code> is replaced with the value of
          <code>a0</code>. Same goes for the other variables. Also, this isn’t
          quite the actual code. I simplified it a little for demonstration
          purposes.
        </p>
        <p>
          The generated Haskell program's second line is a main method that
          calls the function <code>q</code> defined on the first line and prints
          the result. Each argument passed to <code>q</code> is the source code
          for a definition of <code>q</code> in a language in the loop. The
          first argument is a definition of <code>q</code> in Ruby, the second
          in C, the last in Haskell.
        </p>
        <pre><code class="language-hs">main = putStrLn $ q "{Ruby    definition of q}"
                    "{C       definition of q}"
                    "{Haskell definition of q}"
</code></pre>
        <p>
          In all of these definitions, <code>q</code> does the same thing as it
          does in the Haskell program. It prints its first argument, then prints
          a call to a function called <code>q</code>, but in the next language
          in the loop. It also rotates its arguments one position to the left
          before printing them.
        </p>
        <p>
          When the program is run, <code>q</code> starts by printing its first
          argument, which is a declaration of <code>q</code> in Ruby. Then, it
          prints a call to <code>q</code> in Ruby. The arguments to this call
          are the second, third, and first arguments passed to <code>q</code> in
          the Haskell program, which are definitions of <code>q</code> in C,
          Haskell, and Ruby respectively.
        </p>
        <p>
          The output of the Haskell program is a Ruby program with a very
          similar structure. Both have two lines. Both declare a function
          <code>q</code> on the first line. <code>q</code> does the same thing
          in both programs. And both call <code>q</code> on the second line,
          passing in definitions of <code>q</code> for the rest of the loop.
        </p>
        <p>
          When this Ruby program is run, it in turn prints a C program with the
          same structure. And that C program in turn prints a Haskell program
          with the same structure. In fact, it prints the original Haskell
          program, closing the loop.
        </p>
        <p>
          In the next post, I’ll discuss how
          <code>quine-central</code> generates these programs in the first
          place. We’ll also do away with some of the simplifications I made to
          the programs in this post and look at how
          <code>quine-central</code> handles the problems posed by string
          escaping.
        </p>
      </section>
    </article>

    <script src="https://unpkg.com/prismjs@1.21.0/components/prism-core.min.js"></script>
    <script src="https://unpkg.com/prismjs@1.21.0/plugins/autoloader/prism-autoloader.min.js"></script>
  </body>
</html>
